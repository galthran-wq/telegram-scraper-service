---
description: Project structure and architecture conventions for the Python microservice template
alwaysApply: true
---

# Project Structure

This is a FastAPI microservice with a layered architecture.

## Layout

- `src/` — application package (imported as `from src.xxx import yyy`)
- `src/main.py` — app factory (`create_app`), structlog config, lifespan events, Prometheus instrumentation
- `src/config.py` — pydantic-settings based configuration, singleton `settings` object
- `src/dependencies.py` — FastAPI dependency injection providers
- `src/api/router.py` — aggregated API router, includes all endpoint routers
- `src/api/endpoints/` — thin HTTP handlers, one file per domain
- `src/schemas/` — Pydantic request/response models, one file per domain
- `src/services/` — business logic layer, orchestrates data and external calls
- `src/core/exceptions.py` — custom `AppError`, validation error handler, and exception handlers
- `src/core/middleware.py` — CORS, request logging, and request ID middleware

## Conventions

- Endpoints are thin — delegate logic to services
- Services contain business logic — never import FastAPI in services
- Schemas are shared between endpoints and services
- New routers must be registered in `src/api/router.py`
- New middleware/exception handlers must be registered via their `register_*` functions in `src/main.py`
- Configuration uses env vars via `src/config.py` — add new settings to the `Settings` class and `.env.example`
- Use `structlog.get_logger()` for logging
